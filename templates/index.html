<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holoware Medical AI</title>
    <link rel="icon" type="png/x-icon" href="https://holoware.co/wp-content/uploads/2024/06/favicon-1.ico">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        
        .loader {
            width: 120px;
            height: 20px;
            -webkit-mask: linear-gradient(90deg,#000 70%,#0000 0) left/20% 100%;
            background:
                linear-gradient(#213ec0 0 0) left -25% top 0 /20% 100% no-repeat
                #ddd;
            animation: l7 1s infinite steps(6);
        } 
        
       
    </style>
    
</head>
<body>
    <header>
        <h1><img src="https://holoware.co/wp-content/uploads/2024/04/Blue-Logo-new.png" style="width:400px" alt="Holoware Logo"/></h1>
        <h1>Holoware Biomedical Language Models</h1>
        <p>This is a multi-modal medical foundation model. To use it, simply upload your image and type a question or instruction and click 'submit'.</p>
    </header>

    <main>
        <form id="uploadForm" action="/" method="post" enctype="multipart/form-data">
            <label for="image">Input Image:</label>
            <input type="file" id="image" name="image" accept="image/*" required>
            <img id="imagePreview" style="display: none; max-width: 150%; height: auto; margin-top: 28px;" />

            <label for="question">Question/Instruction:</label>
            <input type="text" id="question" name="question" placeholder="Enter your instruction/question..." required>

            <!-- LLM section hidden with CSS -->
            <label for="llm" class="hidden">LLM:</label>
            <select id="llm" name="llm" class="hidden">
                <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
                <option value="med-alpaca">med-alpaca</option>
            </select>

            <button type="submit">Submit</button>
        </form>

        <!-- Processing Modal Structure -->
        <div id="processingModal" class="modal hidden">
            <div class="modal-content">
                <h2>Processing...</h2>
                <div class="loader"></div>
                <p>Please wait holoware AI is process your input.</p>
            </div>
        </div>

        <!-- Output Modal Structure -->
        <div id="outputModal" class="modal hidden">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <h2> Processed Output</h2>
                <img id="outputImage" />
                <pre id="modalContent"></pre>
            </div>
        </div>
    </main>

    <footer>
        <p>Powered by <a href="https://holoware.co">Holoware</a></p>
        <img src="https://holoware.co/wp-content/uploads/2024/04/Blue-Logo-new.png" style="width:100px" alt="Holoware Logo"/>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('uploadForm');
            const imageInput = document.getElementById('image');
            const imagePreview = document.getElementById('imagePreview');
            const processingModal = document.getElementById('processingModal');
            const outputModal = document.getElementById('outputModal');
            const outputImage = document.getElementById('outputImage');
            const modalContent = document.getElementById('modalContent');
            const closeBtn = document.querySelector('.close-btn');

            imageInput.addEventListener('change', () => {
                const file = imageInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imagePreview.src = e.target.result;
                        imagePreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreview.style.display = 'none';
                }
            });

            form.addEventListener('submit', async (event) => {
                event.preventDefault(); // Prevent the form from submitting normally

                const formData = new FormData(form);

                // Show processing modal
                processingModal.style.display = 'block';

                try {
                    // Send form data to the server
                    const response = await fetch('/', {
                        method: 'POST',
                        body: formData,
                    });

                    // Parse the JSON response from the server
                    const data = await response.json();

                    // Hide processing modal
                    processingModal.style.display = 'none';

                    // Set output image and modal content
                    outputImage.src = imagePreview.src;
                    modalContent.textContent = `Output: ${data.table}`;
                    outputModal.style.display = 'block';
                } catch (error) {
                    console.error('Error:', error);
                    processingModal.style.display = 'none';
                    modalContent.textContent = 'An error occurred while processing your request.';
                    outputModal.style.display = 'block';
                }
            });

            closeBtn.addEventListener('click', () => {
                outputModal.style.display = 'none';
            });

            window.addEventListener('click', (event) => {
                if (event.target === outputModal) {
                    outputModal.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
